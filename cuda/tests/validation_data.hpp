#pragma once

#include "phi/phi.hpp"
#include <vector>
#include <string>

namespace phi_test {

struct ValidationCase {
    std::string name;
    size_t n_nodes;
    phi::StateIndex state;
    std::vector<phi::Real> tpm_data;  // Flattened state-by-node
    std::vector<uint8_t> cm_data;     // Flattened row-major
    phi::Real expected_phi;
    size_t expected_n_concepts;
};

inline std::vector<ValidationCase> get_validation_cases() {
    return {
        {
            "and_gate_s0",
            3,
            0,
            {0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "and_gate_s7",
            3,
            7,
            {0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "and_gate_s5",
            3,
            5,
            {0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "and_gate_s2",
            3,
            2,
            {0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "or_gate_s0",
            3,
            0,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "or_gate_s7",
            3,
            7,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "or_gate_s5",
            3,
            5,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "or_gate_s2",
            3,
            2,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "xor_gate_s0",
            3,
            0,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "xor_gate_s7",
            3,
            7,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "xor_gate_s5",
            3,
            5,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "xor_gate_s2",
            3,
            2,
            {0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0},
            {1, 0, 1, 0, 1, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "copy_chain_s0",
            3,
            0,
            {0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0},
            {0, 1, 0, 0, 0, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "copy_chain_s7",
            3,
            7,
            {0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0},
            {0, 1, 0, 0, 0, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "copy_chain_s5",
            3,
            5,
            {0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0},
            {0, 1, 0, 0, 0, 1, 0, 0, 0},
            0.0,
            0
        },
        {
            "copy_chain_s2",
            3,
            2,
            {0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0},
            {0, 1, 0, 0, 0, 1, 0, 0, 0},
            0.0,
            0
        },
        // Majority network - only states 0 and 7 are reachable (deterministic TPM)
        // PyPhi verified: BigPhi = 0.674443, MIP: Cut [n0] -> [n1, n2]
        {
            "majority_s0",
            3,
            0,
            {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 1, 1, 1, 1, 1, 1, 1, 1},
            0.674443,
            6
        },
        {
            "majority_s7",
            3,
            7,
            {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 1, 1, 1, 1, 1, 1, 1, 1},
            0.674443,
            6
        },
        // States 5 and 2 are unreachable in majority network (PyPhi raises error)
        // We still compute phi for these states - they give different results
        // due to the unreachable state dynamics
        {
            "majority_s5",
            3,
            5,
            {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 1, 1, 1, 1, 1, 1, 1, 1},
            0.333333,  // Our computed value for unreachable state
            4
        },
        {
            "majority_s2",
            3,
            2,
            {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0},
            {1, 1, 1, 1, 1, 1, 1, 1, 1},
            0.333333,  // Our computed value for unreachable state
            4
        },
        {
            "iit_4node_s0",
            4,
            0,
            {0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            {0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0},
            0.0,
            0
        },
        {
            "iit_4node_s15",
            4,
            15,
            {0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            {0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0},
            0.0,
            0
        },
        {
            "iit_4node_s5",
            4,
            5,
            {0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            {0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0},
            0.0,
            0
        },
        {
            "iit_4node_s10",
            4,
            10,
            {0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            {0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0},
            0.0,
            0
        }
    };
}

}  // namespace phi_test
